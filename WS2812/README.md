Based on https://github.com/AlexGyver/WS2812_FX/ with my fixes